---
description: 同步 Obsidian vault 并管理版本控制
---

# 同步 Obsidian Vault

你需要帮助用户同步 Obsidian vault，并通过 Git 进行版本控制和备份管理。

## 参数
- 操作类型：$ARGUMENTS 的第一个参数（status、sync、pull、push、commit）
- 提交信息：$ARGUMENTS 的第二个参数（用于 commit 操作）

## 功能模块

### 1. 查看同步状态（Status）

显示 vault 的当前 Git 状态：

**步骤**：
1. 检查 vault 是否是 Git 仓库
2. 运行 `git status` 获取状态
3. 分析并友好展示状态信息

**输出格式**：
```markdown
## Vault 同步状态

### 📂 当前分支
main (origin/main)

### 📝 未提交的更改
**修改的文件**（3个）：
- Daily Notes/2025-01-15.md
- Projects/React/学习 React Hooks.md
- Index.md

**新增的文件**（2个）：
- Projects/新项目想法.md
- Reading/《深入理解TypeScript》.md

**删除的文件**（1个）：
- Archive/旧笔记.md

### 🔄 与远程仓库的关系
- 本地领先远程 2 个提交
- 远程领先本地 0 个提交

### 💡 建议操作
1. 提交当前更改：`/note-sync commit "更新笔记"`
2. 推送到远程：`/note-sync push`
```

### 2. 自动同步（Sync）

执行完整的同步流程：拉取 → 提交 → 推送

**步骤**：
1. **检查 vault 状态**：
   - 确认是 Git 仓库
   - 检查是否有未提交的更改

2. **拉取远程更改**：
   ```bash
   git pull --rebase origin main
   ```
   - 如果有冲突，暂停并提示用户

3. **暂存所有更改**：
   ```bash
   git add .
   ```

4. **创建提交**：
   - 生成智能的提交信息
   - 格式：`sync: YYYY-MM-DD HH:mm - 更新 N 个文件`
   - 列出主要更改的文件

5. **推送到远程**：
   ```bash
   git push origin main
   ```

6. **报告结果**：
   ```markdown
   ## ✅ 同步完成

   ### 📥 从远程拉取
   - 无新更改

   ### 📤 推送到远程
   - 提交信息：sync: 2025-01-15 14:30 - 更新 6 个文件
   - 修改：3 个文件
   - 新增：2 个文件
   - 删除：1 个文件

   ### 🎉 同步成功
   所有笔记已安全备份到远程仓库
   ```

### 3. 拉取更新（Pull）

从远程仓库拉取最新更改：

**步骤**：
1. 检查本地是否有未提交的更改
2. 如果有，询问用户是否：
   - 先提交当前更改
   - 暂存当前更改（stash）
   - 放弃本地更改
3. 执行 `git pull`
4. 如果有冲突：
   - 列出冲突文件
   - 提供解决冲突的指导
   - 询问是否需要帮助解决

**输出格式**：
```markdown
## 📥 拉取远程更新

### ✅ 成功拉取
从 origin/main 拉取了 3 个新提交

**更新的文件**：
- Projects/团队项目.md（更新于 2 小时前）
- Daily Notes/2025-01-15.md（更新于 1 小时前）
- Index.md（更新于 30 分钟前）

### 📋 更新详情
**Commit 1**（2 小时前）：
- 作者：teammate@example.com
- 消息：添加项目进度更新

**Commit 2**（1 小时前）：
- 作者：teammate@example.com
- 消息：更新每日笔记

**Commit 3**（30 分钟前）：
- 作者：you@example.com
- 消息：重组索引结构
```

### 4. 推送更改（Push）

将本地提交推送到远程仓库：

**步骤**：
1. 检查是否有未推送的提交
2. 检查远程是否有新提交（避免冲突）
3. 如果远程有新提交，建议先 pull
4. 执行 `git push`
5. 报告推送结果

**输出格式**：
```markdown
## 📤 推送到远程仓库

### ✅ 推送成功
已推送 2 个提交到 origin/main

**推送的提交**：
1. sync: 2025-01-15 14:00 - 更新 3 个文件
2. sync: 2025-01-15 14:30 - 新增项目笔记

### 🔒 备份确认
你的笔记已安全备份到远程仓库
```

### 5. 提交更改（Commit）

创建一个新的 Git 提交：

**步骤**：
1. 检查是否有待提交的更改
2. 显示将要提交的文件
3. 询问提交信息（如果未提供）
4. 暂存所有更改：`git add .`
5. 创建提交：`git commit -m "message"`
6. 显示提交结果

**输出格式**：
```markdown
## 💾 创建提交

### 📝 提交信息
"更新 React 学习笔记和每日总结"

### 📦 包含的文件
**修改**：
- Projects/React/学习 React Hooks.md
- Daily Notes/2025-01-15.md

**新增**：
- Projects/React/Hooks 最佳实践.md

### ✅ 提交成功
提交 ID：a1b2c3d
提交时间：2025-01-15 14:45:00

### 💡 下一步
运行 `/note-sync push` 将此提交推送到远程仓库
```

## 冲突处理

当遇到 Git 冲突时：

```markdown
## ⚠️ 检测到冲突

### 冲突文件
以下文件存在冲突需要解决：

#### 1. Projects/项目计划.md
**冲突区域**（第 15-20 行）：
```
<<<<<<< HEAD
- 完成功能 A 的开发
- 开始功能 B 的设计
=======
- 完成功能 A 的测试
- 部署到测试环境
>>>>>>> origin/main
```

**冲突原因**：
- 本地版本：关注开发进度
- 远程版本：关注测试和部署

**解决建议**：
1. 保留两个版本的内容（推荐）
2. 选择本地版本
3. 选择远程版本
4. 手动编辑合并

### 🔧 解决步骤
1. 使用 Edit 工具编辑冲突文件
2. 移除冲突标记（<<<<<<, =======, >>>>>>>）
3. 保存合并后的内容
4. 运行 `/note-sync commit "解决冲突"`
```

## 备份管理

### 创建备份点
在重要操作前创建备份：
```bash
git tag -a backup-2025-01-15 -m "定期备份"
git push origin backup-2025-01-15
```

### 查看备份历史
```markdown
## 📅 备份历史

- **backup-2025-01-15**（今天）：定期备份
- **backup-2025-01-08**（7天前）：大规模重组前的备份
- **backup-2025-01-01**（14天前）：月度备份
```

### 恢复到备份点
```markdown
⚠️ 警告：此操作将丢失当前未提交的更改

是否确认恢复到 backup-2025-01-08？
1. 确认恢复
2. 先创建当前状态的备份
3. 取消操作
```

## 最佳实践

### 同步频率建议
- **每日工作结束**：运行 `/note-sync sync`
- **重要更改后**：立即 commit 和 push
- **多设备使用**：每次开始工作前先 pull

### 提交信息规范
好的提交信息示例：
- ✅ `添加 React Hooks 学习笔记`
- ✅ `更新项目进度和每日总结`
- ✅ `重构索引结构，优化导航`

避免的提交信息：
- ❌ `更新`
- ❌ `修改`
- ❌ `sync`

### Git 配置建议
首次使用前配置：
```bash
# 设置用户信息
git config --global user.name "Your Name"
git config --global user.email "your@email.com"

# 设置默认编辑器
git config --global core.editor "code --wait"

# 忽略某些文件
echo ".obsidian/workspace.json" >> .gitignore
echo ".DS_Store" >> .gitignore
```

## 安全提示

1. **敏感信息检查**：
   - 在提交前检查是否包含密码、API 密钥等敏感信息
   - 使用 `.gitignore` 排除私密笔记

2. **远程仓库选择**：
   - 私密笔记使用私有仓库
   - 公开分享的笔记可以使用公共仓库

3. **定期备份**：
   - 每周创建一个标签作为备份点
   - 保持至少 3 个历史备份

## 故障排查

### 常见问题

**问题 1**：推送失败（远程领先本地）
```
解决方案：先运行 /note-sync pull，然后再推送
```

**问题 2**：大量冲突文件
```
解决方案：
1. 创建当前状态备份
2. 使用 git reset --hard origin/main 重置到远程状态
3. 从备份中手动恢复重要更改
```

**问题 3**：文件编码问题
```
解决方案：确保所有笔记使用 UTF-8 编码
```

## 示例用法

```bash
# 查看同步状态
/note-sync status

# 完整同步流程
/note-sync sync

# 仅拉取远程更新
/note-sync pull

# 提交当前更改
/note-sync commit "更新学习笔记和项目进度"

# 推送到远程
/note-sync push

# 不带参数调用，交互式选择
/note-sync
```

## 注意事项
- 首次使用需要初始化 Git 仓库
- 确保配置了正确的远程仓库
- 大文件（如图片、视频）建议使用 Git LFS
- 定期检查 .gitignore 确保不提交临时文件
- 多人协作时制定提交规范
